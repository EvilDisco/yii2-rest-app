Тестовое приложение REST API для Yii 2
===============================

### Первоначальное развёртывание

Предполагается, что базовое программное окружение настроено (docker, docker-compose).

1. Склонируйте проект с Гитхаба и перейдите в папку проекта.
2. Выполните в терминале команду `docker-compose run --rm backend composer install`
3. Выполните команду `docker-compose run --rm backend php /app/init --env=Development`
4. Запустите контейнеры: `docker-compose up -d`
5. Запустите миграции для основной базы данных: `docker-compose run --rm backend yii migrate`
6. Разверните сиды: `docker-compose run --rm backend yii seed/articles`

Команду `yii seed/articles` можно выполнять повторно. В этом случае данные в базе будут перезаписаны новыми.

### Работа с API

Общий урл-префикс эндпоинтов - http://127.0.0.1:21080/index.php

Фильтрация, сортировка и пагинация - GET-параметры.

Для сортировки используется параметр `sort` с указанием нужного поля. Для обратного порядка сортировки перед названием поля нужно поставить знак минуса (например, `sort=-created_at`)

Для пагинации в списках используются параметры `per-page` (кол-во элементов на странице результатов) и `page` (текущая страница).

Доступны следующие эндпоинты API:
* GET `/api/v1/authors` - получить список авторов статей
  * фильтрация:
    * `full_name` - поиск по части ФИО
  * сортировка:
    * `full_name` - по ФИО (используется по умолчанию)
    * `birth_year` - по году рождения
    * `created_at` - по времени создания
* GET `/api/v1/authors/{id}` - получить автора статей по id
* GET `/api/v1/categories` - получить список категорий статей
  * фильтрация:
    * `name` - поиск по части названия
    * `parent_id` - поиск по id родительской категории
  * сортировка:
    * `name` - по названию (используется по умолчанию)
    * `created_at` - по времени создания
* GET `/api/v1/categories/{id}` - получить категорию статьи по id
* GET `/api/v1/articles` - получить список статей
  * фильтрация:
    * `title` - поиск по части названия
    * `author_id` - поиск по id автора
    * `author_full_name` - поиск по части ФИО автора
    * `category_id` - поиск по id категории
    * `category_name` - поиск по части названия категории
  * сортировка:
    * `created_at` - по времени создания (используется по умолчанию, обратный порядок - "сначала новые")
    * `title` - по названию
* GET `/api/v1/articles/{id}` - получить статью по id

### Тесты

Для запуска тестов требуется развернуть тестовое окружение:

1. Сгенерируйте вспомогательные файлы для тестового окружения: `docker-compose run --rm backend vendor/bin/codecept build`
2. Создайте тестовую базу с названием, указанным в `.env`-переменной `TEST_DB_DSN` (по умолчанию `rest_test`).
3. Запустите миграции для тестовой базы данных: `docker-compose run --rm backend yii_test migrate`
4. Разверните сиды для тестовой базы данных: `docker-compose run --rm backend yii_test seed/articles`
5. Запустите тесты: `docker-compose run --rm backend vendor/bin/codecept run backend/tests`

### Известные проблемы

Тестовая среда зависит от сидов. При повторном выполнении в тестовом окружении команды сидов тесты сломаются. Чинится повторным созданием тестовой базы с накатом миграций и сидов.

### Дорожная карта

* полноценные фикстуры тестов
* фикс генерации превью картинок
* FIXME и TODO
* дополнительные тесты эндпоинтов
* Swagger
* phpstan
* Apache -> nginx

### Дополнительная информация

За основу взят пакет [yiisoft/yii2-app-advanced](https://github.com/yiisoft/yii2-app-advanced)